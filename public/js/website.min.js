$.ajaxSetup({
  headers: {
    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
  }
});
var mijnAantalStationRequests = 0;
var station = $("#name").val();
var treinTijd = $("#treinTijd").val();

//Element functies
jQuery.fn.extend({
    toonMenu : function(){
        if($(this).attr("id") == "backpopup"){
            $.ajax({
                type: "GET",
                url: "/minidagboek/backups/initialise",
                data: '',
                success: function(data) {
                    $("#backupitemscont3").html(data);
                }
            });
        }
        $(this).css("display", "inline");
        $("body").css("overflowY", "hidden");

        //setTimeout(function(){
        openmenu.push($(this).attr('id'));
        console.log(openmenu.length);
        $("#" + openmenu[openmenu.length-1]).css("background-color", "rgba(130, 130, 130, 0.61)");
        if(openmenu.length > 1){
            $("#" + openmenu[openmenu.length-2]).css("background-color", "transparent");
        }
        //}, 100);
        
    },
    hideMenu : function(){
        $(this).css("display", "none");
        $("body").css("overflowY", "scroll");
        openmenu.pop();
        $("#" + openmenu[openmenu.length-1]).css("background-color", "rgba(130, 130, 130, 0.61)");
    },
    addSpinner: function (length, width, radius, kleur, vervang = "replace") {
        var originalHtml = $(this).html();
        var originalEl = $(this);
        var opts = {
            lines: 12,            // The number of lines to draw
            length: length,            // The length of each line
            width: width,             // The line thickness
            radius: radius,           // The radius of the inner circle
            scale: 1.0,           // Scales overall size of the spinner
            corners: 0,           // Roundness (0..1)
            color: kleur,        // #rgb or #rrggbb
            opacity: 1/4,         // Opacity of the lines
            rotate: 0,            // Rotation offset
            direction: 1,         // 1: clockwise, -1: counterclockwise
            speed: 1,             // Rounds per second
            trail: 100,           // Afterglow percentage
            fps: 20,              // Frames per second when using setTimeout()
            zIndex: 2e9,          // Use a high z-index by default
            className: 'spinner', // CSS class to assign to the element
            top: '50%',           // center vertically
            left: '50%',          // center horizontally
            shadow: false,        // Whether to render a shadow
            hwaccel: false,       // Whether to use hardware acceleration (might be buggy)
            position: 'absolute'  // Element positioning
        };

        $(this).html("<div id='ajaxSpinner'></div>");
        var target = document.getElementById("ajaxSpinner");
        var spinner = new Spinner(opts).spin(target);
        
        //Wanneer ajax klaar is
       /* if(vervang == "replace"){
          $( document ).ajaxComplete(function() {
              originalEl.html(originalHtml);
          });
        }*/
    }
});

function getTreinen(actie){
    if(actie == 0){
        station = document.getElementById("name").value;
        treinTijd = document.getElementById("treinTijd").value;
    } 
    if(mijnAantalStationRequests == 0){
      $("#rechterdeelId").addSpinner(5, 1, 5, "black", "no replace");
    }
    else{
      $("#extraTreinenBtn").addSpinner(5, 1, 5, "white", "replace");
    }
    
    $.ajax({
      url: '/test',
      type: 'GET',
      data: { 'aantalStationRequests': mijnAantalStationRequests,'name': station, 'treinTijd': treinTijd},
      success: function(data){
        var tekst = "<div id='treinen'>" + data[0] + "</div>";
        
        tekst += "<div id='extraTreinenBtnCont'>" + data[1] + "</div>";
        $("#rechterdeelId").html(tekst);
        mijnAantalStationRequests++;
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        if (XMLHttpRequest.readyState == 4) {
          var text = '<div class="col-lg-10 col-lg-offset-1 text-center"><div class="jumbotron"><h2>Er passeren geen treinen in ' + station + ' op dit tijdstip</h2></div></div>';
            $("#treinen").html(text);
        }
        else if (XMLHttpRequest.readyState == 0) {
            var text = '<div class="col-lg-10 col-lg-offset-1 text-center"><div class="jumbotron"><h2>Er is een fout opgetreden, onze excuses hiervoor</h2></div></div>';
            $("#treinen").html(text);
        }
        else {
            var text = '<div class="col-lg-10 col-lg-offset-1 text-center"><div class="jumbotron"><h2>Er is een fout opgetreden, onze excuses hiervoor</h2></div></div>';
            $("#treinen").html(text);
        }
    }
    });
}


$(document).on('click', '.meerStations', function(){
  var idDropdown = this.id + "stations";
  if($('#' + idDropdown).css("display") == "block"){
    $('#' + idDropdown).css("display", "none");
    $(this).find(".meerStationsIMG").css("background-image", "url('../images/expand.png");
  }
  else{
    $('#' + idDropdown).css("display","block");
    $(this).find(".meerStationsIMG").css("background-image", "url('../images/expand_reverse.png");
  }
});